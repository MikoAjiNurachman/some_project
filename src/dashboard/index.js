import React, { useEffect, useState } from 'react'
import Headers from './../templates/headers'
import './../assets/dashboard.css'
import { useDispatch,useSelector } from 'react-redux'
import { Logout, products } from '../redux/action'
import { useHistory } from 'react-router-dom'

export default function Index() {
    const active = 'dashboard'
    const history = useHistory()
    const selector = useSelector(state => state)
    const [productActive,setProductActive] = useState(0)
    const [dailySales,setDailySales] = useState(0)
    const [monthlySales,setMonthlySales] = useState(0)
    const [unpaidSales,setUnpaidSales] = useState(0)
    const dispatch = useDispatch()
    const getDateNowToString = (when) => {
        let dateobj = new Date()
        let getZero = (number) => {
            return 0 < number && number < 10 ? "0"+number : number 
        }
        if (when === 'now') return (dateobj.getFullYear()+"-"+getZero(dateobj.getMonth()+1)+"-"+getZero(dateobj.getDate())).toString()
        if (when === 'first') return (dateobj.getFullYear()+"-"+getZero(dateobj.getMonth()+1)+"-01").toString()
    }

    useEffect(() => {
        if (selector.login.token === null || selector.login === {}) {
            dispatch(Logout())
        }
        const headers = {
            method: 'GET',
            headers: {'Authorization': selector.login.token}
        }
        fetch(`http://localhost:8080/getProduct/${selector.login.data.user_id}/`,headers)
        .then(res => res.json())
        .then(resp => {
            dispatch(products(resp))
            const fill = resp.filter(element => element.product_status === 'active')
            setProductActive(fill.length)
        })
        .catch(err => dispatch(Logout())) 
        fetch(`http://localhost:8080/getInvoice/${selector.login.data.user_id}/`,headers)
        .then(res => res.json())
        .then(resp => {
            const now = new Date(getDateNowToString('now'))
            const firstDate = new Date(getDateNowToString('first'))
            let daily = 0
            let month = 0
            let unpaid = 0
                resp.forEach(element => {
                    let l_mark = new Date(element.l_market)
                    if (l_mark.getTime() === now.getTime()) {
                        daily++
                    } 
                    if (firstDate.getTime() <= l_mark.getTime() && l_mark.getTime() <= now.getTime()) {
                        month++
                    }
                    if (firstDate.getTime() <= l_mark.getTime() && l_mark.getTime() <= now.getTime() && element.status === 'unpaid') {
                        unpaid++
                    }
                })
                setUnpaidSales(unpaid)
                setMonthlySales(month)
                setDailySales(daily)
        }).catch(err => console.error(err))
    },[dispatch,selector.login,history])
    return (
        <>
            <Headers active={active}/>
            <div className="dashboard-container">
                <div className="dashboard-content">
                    <div className="box-content first">
                        <div className="content-parent">
                        <div className="content-left">
                            <i>
                                <svg width="80" height="80" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M44.1406 3.90625H41.7969V0H37.8906V3.90625H12.1094V0H8.20312V3.90625H5.85938C2.62833 3.90625 0 6.53458 0 9.76562V44.1406C0 47.3717 2.62833 50 5.85938 50H44.1406C47.3717 50 50 47.3717 50 44.1406V9.76562C50 6.53458 47.3717 3.90625 44.1406 3.90625ZM5.85938 7.8125H8.20312V11.7188H12.1094V7.8125H37.8906V11.7188H41.7969V7.8125H44.1406C45.2175 7.8125 46.0938 8.68874 46.0938 9.76562V14.4531H3.90625V9.76562C3.90625 8.68874 4.78249 7.8125 5.85938 7.8125ZM44.1406 46.0938H5.85938C4.78249 46.0938 3.90625 45.2175 3.90625 44.1406V18.3594H46.0938V44.1406C46.0938 45.2175 45.2175 46.0938 44.1406 46.0938ZM30.8594 41.9922H42.5781V30.2734H30.8594V41.9922ZM34.7656 34.1797H38.6719V38.0859H34.7656V34.1797Z" fill="black"/>
                                </svg>  
                            </i>
                        </div>
                        <div className="content-right">
                            <div className="text-content">
                                <h2>Daily Sales</h2>
                                <h2 style={{fontSize: "2.7rem"}}>{dailySales}</h2>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div className="box-content second">
                        <div className="content-parent">
                        <div className="content-left">
                            <i>
                                <svg width="150" height="150" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M74.5203 40.0694L61.8133 35.1475C62.4779 33.2591 62.68 31.2388 62.4028 29.2561C62.1256 27.2735 61.3771 25.3861 60.2201 23.7524C59.063 22.1186 57.5312 20.7861 55.753 19.8664C53.9748 18.9467 52.002 18.4668 50 18.4668C47.998 18.4668 46.0252 18.9467 44.247 19.8664C42.4688 20.7861 40.937 22.1186 39.7799 23.7524C38.6229 25.3861 37.8744 27.2735 37.5972 29.2561C37.32 31.2388 37.5222 33.2591 38.1867 35.1475L25.4797 40.0694C25.2232 40.1694 25.0029 40.3446 24.8476 40.572C24.6923 40.7993 24.6093 41.0683 24.6094 41.3436V70.8186C24.6093 71.0943 24.6926 71.3636 24.8483 71.5912C25.0041 71.8187 25.225 71.9939 25.482 72.0936L49.5055 81.4061C49.6632 81.467 49.8309 81.4983 50 81.4983C50.1674 81.4949 50.3327 81.4604 50.4875 81.3967L50.4945 81.4061L74.5203 72.0936C74.7769 71.9935 74.9973 71.8182 75.1526 71.5907C75.3079 71.3632 75.3909 71.0941 75.3906 70.8186V41.3436C75.3907 41.0683 75.3077 40.7993 75.1524 40.572C74.9971 40.3446 74.7768 40.1694 74.5203 40.0694V40.0694ZM70.243 41.3436L65.8078 43.0623L58.4578 40.2342C59.2952 39.4638 60.0242 38.5834 60.625 37.617L70.243 41.3436ZM55.7688 42.1295L62.0188 44.5334L58.4898 45.9006L52.0164 43.3717C53.3254 43.1603 54.5922 42.7409 55.7688 42.1295V42.1295ZM60.0227 48.2381L64.6141 46.4584V52.1545L63.8461 51.6538C63.5775 51.4789 63.256 51.4039 62.9377 51.4419C62.6194 51.4799 62.3246 51.6284 62.1047 51.8616L60.0227 54.0709V48.2381ZM50 21.2358C51.9361 21.2358 53.8287 21.8099 55.4385 22.8855C57.0483 23.9612 58.303 25.49 59.0439 27.2787C59.7848 29.0675 59.9787 31.0357 59.601 32.9346C59.2233 34.8335 58.2909 36.5777 56.9219 37.9468C55.5529 39.3158 53.8086 40.2481 51.9098 40.6258C50.0109 41.0035 48.0426 40.8097 46.2539 40.0688C44.4652 39.3279 42.9363 38.0732 41.8607 36.4634C40.7851 34.8536 40.2109 32.9609 40.2109 31.0248C40.2138 28.4295 41.2461 25.9413 43.0813 24.1061C44.9165 22.271 47.4047 21.2387 50 21.2358V21.2358ZM40.1563 38.7358L38.3266 38.0209L39.3742 37.6147C39.6143 38.0031 39.8753 38.3782 40.1563 38.7381V38.7358ZM34.5555 39.4827L54.7148 47.3631L50 49.1905L29.757 41.3436L34.5555 39.4827ZM27.3438 69.8819V43.3405L48.6328 51.5936V78.135L27.3438 69.8819ZM51.3672 78.135V51.5936L57.2883 49.2967V57.5163C57.2884 57.7901 57.3708 58.0576 57.5247 58.2841C57.6786 58.5106 57.897 58.6856 58.1516 58.7866C58.3118 58.8507 58.4829 58.8836 58.6555 58.8834C58.8419 58.8835 59.0264 58.8454 59.1976 58.7715C59.3687 58.6976 59.523 58.5895 59.6508 58.4538L63.3109 54.5686L65.2352 55.8186C65.4414 55.9519 65.6797 56.0272 65.9251 56.0366C66.1705 56.046 66.4139 55.9891 66.6297 55.8719C66.8455 55.7547 67.0258 55.5816 67.1516 55.3707C67.2774 55.1598 67.344 54.9189 67.3445 54.6733V45.3983L72.6562 43.3405V69.8819L51.3672 78.135Z" fill="black"/>
                                    <path d="M47.5649 35.0481C47.817 35.2615 48.138 35.3764 48.4683 35.3715C48.7986 35.3666 49.116 35.2423 49.3617 35.0215L55.9922 29.0621C56.1327 28.9441 56.2481 28.799 56.3313 28.6355C56.4146 28.472 56.4641 28.2934 56.4769 28.1104C56.4896 27.9273 56.4655 27.7436 56.4057 27.5701C56.346 27.3966 56.252 27.2369 56.1292 27.1005C56.0065 26.9642 55.8575 26.8539 55.6913 26.7763C55.525 26.6987 55.3448 26.6553 55.1614 26.6488C54.9781 26.6423 54.7953 26.6728 54.6239 26.7384C54.4526 26.8041 54.2962 26.9035 54.1641 27.0309L48.4203 32.1941L45.8047 29.9832C45.5278 29.7491 45.1692 29.6345 44.8078 29.6648C44.4464 29.695 44.1119 29.8676 43.8778 30.1445C43.6436 30.4215 43.5291 30.7801 43.5593 31.1414C43.5896 31.5028 43.7622 31.8374 44.0391 32.0715L47.5649 35.0481Z" fill="black"/>
                                </svg>
                            </i>
                        </div>
                        <div className="content-right">
                            <div className="text-content">
                                <h2>Actived Product</h2>
                                <h2 style={{fontSize: "2.7rem"}}>{productActive}</h2>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div className="box-content third">
                        <div className="content-parent">
                        <div className="content-left">
                            <i>
                                <svg width="68" height="80" viewBox="0 0 38 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M24.6254 16.6968H16.6716C16.2671 16.6968 15.9391 16.3689 15.9391 15.9644C15.9391 15.5598 16.2671 15.2319 16.6716 15.2319H24.6254C25.0299 15.2319 25.3578 15.5598 25.3578 15.9644C25.3578 16.3689 25.03 16.6968 24.6254 16.6968Z" fill="black"/>
                                    <path d="M32.5793 12.9375H16.6716C16.2671 12.9375 15.9391 12.6097 15.9391 12.2051C15.9391 11.8005 16.2671 11.4727 16.6716 11.4727H32.5793C32.9838 11.4727 33.3117 11.8005 33.3117 12.2051C33.3117 12.6097 32.9838 12.9375 32.5793 12.9375Z" fill="black"/>
                                    <path d="M24.6254 28.9712H16.6716C16.2671 28.9712 15.9391 28.6434 15.9391 28.2388C15.9391 27.8342 16.2671 27.5063 16.6716 27.5063H24.6254C25.0299 27.5063 25.3578 27.8342 25.3578 28.2388C25.3578 28.6434 25.03 28.9712 24.6254 28.9712Z" fill="black"/>
                                    <path d="M32.5793 25.2114H16.6716C16.2671 25.2114 15.9391 24.8836 15.9391 24.479C15.9391 24.0744 16.2671 23.7466 16.6716 23.7466H32.5793C32.9838 23.7466 33.3117 24.0744 33.3117 24.479C33.3117 24.8836 32.9838 25.2114 32.5793 25.2114Z" fill="black"/>
                                    <path d="M24.6254 41.2456H16.6716C16.2671 41.2456 15.9391 40.9178 15.9391 40.5132C15.9391 40.1086 16.2671 39.7808 16.6716 39.7808H24.6254C25.0299 39.7808 25.3578 40.1086 25.3578 40.5132C25.3578 40.9178 25.03 41.2456 24.6254 41.2456Z" fill="black"/>
                                    <path d="M32.5793 37.4858H16.6716C16.2671 37.4858 15.9391 37.158 15.9391 36.7534C15.9391 36.3488 16.2671 36.021 16.6716 36.021H32.5793C32.9838 36.021 33.3117 36.3488 33.3117 36.7534C33.3117 37.158 32.9838 37.4858 32.5793 37.4858Z" fill="black"/>
                                    <path d="M25.3332 6.89951H12.6668C11.4629 6.89951 10.4834 5.92012 10.4834 4.71621V2.1834C10.4835 0.979492 11.4629 0 12.6668 0H25.3331C26.537 0 27.5165 0.979492 27.5165 2.1834V4.71621C27.5165 5.92012 26.5371 6.89951 25.3332 6.89951ZM12.6668 1.46484C12.2706 1.46484 11.9482 1.78721 11.9482 2.1834V4.71621C11.9482 5.1124 12.2706 5.43467 12.6668 5.43467H25.3331C25.7293 5.43467 26.0517 5.1123 26.0517 4.71621V2.1834C26.0517 1.78711 25.7293 1.46484 25.3331 1.46484H12.6668Z" fill="black"/>
                                    <path d="M9.90988 17.6786H6.6547C5.57042 17.6786 4.68829 16.7965 4.68829 15.7122V12.4571C4.68829 11.3729 5.57042 10.4907 6.6547 10.4907H9.90988C10.9942 10.4907 11.8763 11.3729 11.8763 12.4571V15.7123C11.8763 16.7965 10.9942 17.6786 9.90988 17.6786ZM6.6547 11.9556C6.37814 11.9556 6.15314 12.1806 6.15314 12.4571V15.7123C6.15314 15.9889 6.37814 16.2139 6.6547 16.2139H9.90988C10.1864 16.2139 10.4114 15.9889 10.4114 15.7123V12.4571C10.4114 12.1806 10.1864 11.9556 9.90988 11.9556H6.6547Z" fill="black"/>
                                    <path d="M9.90988 29.9526H6.6547C5.57042 29.9526 4.68829 29.0705 4.68829 27.9862V24.7311C4.68829 23.6468 5.57042 22.7646 6.6547 22.7646H9.90988C10.9942 22.7646 11.8763 23.6468 11.8763 24.7311V27.9862C11.8763 29.0705 10.9942 29.9526 9.90988 29.9526ZM6.6547 24.2295C6.37814 24.2295 6.15314 24.4545 6.15314 24.7311V27.9862C6.15314 28.2628 6.37814 28.4878 6.6547 28.4878H9.90988C10.1864 28.4878 10.4114 28.2628 10.4114 27.9862V24.7311C10.4114 24.4545 10.1864 24.2295 9.90988 24.2295H6.6547Z" fill="black"/>
                                    <path d="M9.90988 42.2267H6.6547C5.57042 42.2267 4.68829 41.3445 4.68829 40.2602V37.0051C4.68829 35.9207 5.57042 35.0386 6.6547 35.0386H9.90988C10.9942 35.0386 11.8763 35.9207 11.8763 37.0051V40.2602C11.8763 41.3445 10.9942 42.2267 9.90988 42.2267ZM6.6547 36.5035C6.37814 36.5035 6.15314 36.7286 6.15314 37.0052V40.2603C6.15314 40.5368 6.37814 40.7619 6.6547 40.7619H9.90988C10.1864 40.7619 10.4114 40.5368 10.4114 40.2603V37.0052C10.4114 36.7286 10.1864 36.5035 9.90988 36.5035H6.6547Z" fill="black"/>
                                    <path d="M34.5812 49.9999H3.41886C1.66925 49.9999 0.245911 48.5766 0.245911 46.827V5.89014C0.245911 4.14062 1.66935 2.71729 3.41886 2.71729H7.80802C8.21251 2.71729 8.54044 3.04512 8.54044 3.44971C8.54044 3.8543 8.21251 4.18213 7.80802 4.18213H3.41886C2.47697 4.18213 1.71075 4.94834 1.71075 5.89014V46.8269C1.71075 47.7687 2.47706 48.535 3.41886 48.535H34.5812C35.5231 48.535 36.2893 47.7686 36.2893 46.8269V5.89014C36.2893 4.94824 35.523 4.18213 34.5812 4.18213H30.192C29.7875 4.18213 29.4596 3.8543 29.4596 3.44971C29.4596 3.04512 29.7875 2.71729 30.192 2.71729H34.5812C36.3308 2.71729 37.7541 4.14062 37.7541 5.89014V46.8269C37.7541 48.5766 36.3307 49.9999 34.5812 49.9999Z" fill="black"/>
                                </svg>
                            </i>
                        </div>
                        <div className="content-right">
                            <div className="text-content">
                                <h2>Monthly Sales</h2>
                                <h2 style={{fontSize: "2.7rem"}}>{monthlySales}</h2>
                            </div>
                        </div>
                        </div>
                    </div>
                    <div className="box-content fourth">
                        <div className="content-parent">
                        <div className="content-left">
                            <i>
                                <svg width="80" height="80" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12.0968 29.0321C13.4305 29.0321 14.5161 27.9464 14.5161 26.6127C14.5161 25.279 13.4305 24.1934 12.0968 24.1934C10.7631 24.1934 9.67743 25.279 9.67743 26.6127C9.67743 27.9464 10.7631 29.0321 12.0968 29.0321ZM12.0968 25.8063C12.5417 25.8063 12.9032 26.1685 12.9032 26.6127C12.9032 27.0569 12.5417 27.4192 12.0968 27.4192C11.6518 27.4192 11.2903 27.0569 11.2903 26.6127C11.2903 26.1685 11.6518 25.8063 12.0968 25.8063Z" fill="black"/>
                                    <path d="M25.2363 9.10742L21.7742 12.5695L18.3121 9.10742L17.1718 10.2478L20.6338 13.7099L17.1718 17.1719L18.3121 18.3123L21.7742 14.8502L25.2363 18.3123L26.3766 17.1719L22.9146 13.7099L26.3766 10.2478L25.2363 9.10742Z" fill="black"/>
                                    <path d="M43.8493 24.3621L41.1291 23.5856V23.1749C42.5896 22.1534 43.5484 20.4621 43.5484 18.5492V16.9363C43.5484 14.6902 42.2265 12.7516 40.3226 11.8436V2.41935C40.3226 1.08564 39.237 0 37.9032 0H5.64518C4.31147 0 3.22583 1.08564 3.22583 2.41935V44.3548C3.22583 45.6886 4.31147 46.7742 5.64518 46.7742H32.2581V50H43.5484V39.3677C43.8016 39.4582 44.0709 39.5161 44.3549 39.5161C45.6886 39.5161 46.7742 38.4305 46.7742 37.0968V28.2396C46.7742 26.4483 45.5716 24.8539 43.8493 24.3621V24.3621ZM43.4066 25.9128C44.4395 26.2089 45.1613 27.1654 45.1613 28.2396V31.4516H43.5484V29.8387H41.9355V35.4839H33.871V29.8387H32.2581V31.4516H30.6452V28.2396C30.6452 27.1646 31.367 26.2081 32.3998 25.9128L35.2492 25.0992L37.0968 26.9468V29.0323H38.7097V26.9468L40.5573 25.0992L43.4066 25.9128ZM35.4839 11.8428C34.8798 12.1306 34.3341 12.5193 33.871 12.9918V6.45161H9.67744V20.9677H32.8106C33.2339 21.8549 33.8781 22.6153 34.6774 23.1741V23.5848L31.9572 24.3621C30.2349 24.8539 29.0323 26.4483 29.0323 28.2396V37.0968C29.0323 38.4305 30.1179 39.5161 31.4516 39.5161C31.7355 39.5161 32.0049 39.4582 32.2581 39.3677V41.9355H8.06454V4.83871H35.4839V11.8428ZM32.2581 17.7419V18.5484C32.2581 18.8225 32.2849 19.0902 32.3227 19.3548H11.2903V8.06452H32.2581V17.7419ZM37.9032 25.4725L36.4203 23.9896C36.8936 24.1187 37.3894 24.1935 37.9032 24.1935C38.4171 24.1935 38.9129 24.1187 39.3862 23.9896L37.9032 25.4725ZM30.6452 33.0645H32.2581V37.0968C32.2581 37.541 31.8966 37.9032 31.4516 37.9032C31.0067 37.9032 30.6452 37.541 30.6452 37.0968V33.0645ZM41.9355 16.9355V18.5484C41.9355 20.7716 40.1265 22.5806 37.9032 22.5806C35.68 22.5806 33.871 20.7716 33.871 18.5484V16.9355C33.871 14.7122 35.68 12.9032 37.9032 12.9032C40.1265 12.9032 41.9355 14.7122 41.9355 16.9355ZM5.64518 45.1613C5.20022 45.1613 4.83873 44.799 4.83873 44.3548V2.41935C4.83873 1.97518 5.20022 1.6129 5.64518 1.6129H37.9032C38.3482 1.6129 38.7097 1.97518 38.7097 2.41935V11.3549C38.4451 11.3171 38.1773 11.2903 37.9032 11.2903C37.6292 11.2903 37.3614 11.3171 37.0968 11.3549V3.22581H6.45164V43.5484H32.2581V45.1613H5.64518ZM41.9355 48.3871H38.7097V38.7097H37.0968V48.3871H33.871V37.0968H41.9355V48.3871ZM44.3549 37.9032C43.9099 37.9032 43.5484 37.541 43.5484 37.0968V33.0645H45.1613V37.0968C45.1613 37.541 44.7998 37.9032 44.3549 37.9032Z" fill="black"/>
                                    <path d="M37.0968 30.645H38.7097V32.2579H37.0968V30.645Z" fill="black"/>
                                </svg>
                            </i>
                        </div>
                        <div className="content-right">
                            <div className="text-content">
                                <h2>Unpaid Sales</h2>
                                <h2 style={{fontSize: "2.7rem"}}>{unpaidSales}</h2>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </>
    )
}
